"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.openEventSource = void 0;
const ServerDisconnected_1 = require("./editor/components/Notifications/ServerDisconnected");
let source = null;
const openEventSource = () => {
    source = new EventSource('/events');
    source.addEventListener('message', (event) => {
        const newEvent = JSON.parse(event.data);
        if (newEvent.type === 'new-input-props' ||
            newEvent.type === 'new-env-variables') {
            window.location.reload();
        }
        if (newEvent.type === 'new-public-folder') {
            window.remotion_staticFiles = newEvent.files;
        }
    });
    source.addEventListener('open', () => {
        var _a;
        (_a = ServerDisconnected_1.serverDisconnectedRef.current) === null || _a === void 0 ? void 0 : _a.setServerConnected();
        source.addEventListener('error', () => {
            var _a;
            // Display an error message that the preview server has disconnected.
            (_a = ServerDisconnected_1.serverDisconnectedRef.current) === null || _a === void 0 ? void 0 : _a.setServerDisconnected();
            source === null || source === void 0 ? void 0 : source.close();
            // Retry later
            setTimeout(() => {
                (0, exports.openEventSource)();
            }, 1000);
        }, { once: true });
    });
};
exports.openEventSource = openEventSource;
