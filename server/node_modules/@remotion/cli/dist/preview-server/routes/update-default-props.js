"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateDefaultPropsHandler = void 0;
const fs_1 = require("fs");
const update_default_props_1 = require("../../codemods/update-default-props");
const date_serialization_1 = require("../../editor/components/RenderModal/SchemaEditor/date-serialization");
const project_info_1 = require("../project-info");
const updateDefaultPropsHandler = async ({ input: { compositionId, defaultProps }, remotionRoot }) => {
    const projectInfo = await (0, project_info_1.getProjectInfo)(remotionRoot);
    // TODO: What happens if this error is thrown? Handle in frontend
    if (!projectInfo.videoFile) {
        throw new Error('Cannot find Roo.tsx file in project');
    }
    // TODO: Pass error to frontend
    const updated = await (0, update_default_props_1.updateDefaultProps)({
        compositionId,
        input: (0, fs_1.readFileSync)(projectInfo.videoFile, 'utf-8'),
        newDefaultProps: (0, date_serialization_1.deserializeJSONWithDate)(defaultProps),
    });
    (0, fs_1.writeFileSync)(projectInfo.videoFile, updated);
};
exports.updateDefaultPropsHandler = updateDefaultPropsHandler;
