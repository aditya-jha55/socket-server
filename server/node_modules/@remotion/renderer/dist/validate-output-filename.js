"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateOutputFilename = void 0;
const audio_codec_1 = require("./audio-codec");
const file_extensions_1 = require("./file-extensions");
const validateOutputFilename = ({ codec, audioCodec, extension, preferLossless, }) => {
    if (!file_extensions_1.defaultFileExtensionMap[codec]) {
        throw new TypeError(`The codec "${codec}" is not supported. Supported codecs are: ${Object.keys(file_extensions_1.defaultFileExtensionMap).join(', ')}`);
    }
    const map = file_extensions_1.defaultFileExtensionMap[codec];
    const resolvedAudioCodec = audioCodec !== null && audioCodec !== void 0 ? audioCodec : (0, audio_codec_1.getDefaultAudioCodec)({ codec, preferLossless });
    if (resolvedAudioCodec === null) {
        if (extension !== map.default) {
            throw new TypeError(`When using the ${codec} codec, the output filename must end in .${map.default}.`);
        }
        return;
    }
    if (!(resolvedAudioCodec in map.forAudioCodec)) {
        throw new Error(`Audio codec ${resolvedAudioCodec} is not supported for codec ${codec}`);
    }
    const acceptableExtensions = map.forAudioCodec[resolvedAudioCodec].possible;
    if (!acceptableExtensions.includes(extension)) {
        throw new TypeError(`When using the ${codec} codec with the ${resolvedAudioCodec} audio codec, the output filename must end in one of the following: ${acceptableExtensions.join(', ')}.`);
    }
};
exports.validateOutputFilename = validateOutputFilename;
